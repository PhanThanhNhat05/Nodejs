extends ../../layouts/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
block main
    +alert-success(5000)
    h1 Danh Sách Sản Phẩm Quản Trị Viên

    .card.mb-3
        .card-header Bộ lọc và Tìm kiếm
        .card-body
            .row
                .col-6
                    +filter-status(filterStatus)

                .col-6
                    +search(keyword)                   
                    +formChangeMulti(`${prefixAdmin}/products/change-multi?_method=PATCH`)
                .col-4
                    a(
                    href=`${prefixAdmin}/products/create`
                    class="btn btn-outline-success"
                ) + Thêm mới
    .card.mb-3
        .card-header Sắp xếp
        .card-body
            .row
                .col-4
                    +sort()
             
    .admin-products
        table(class=".table-admin" checkbox-multi)
            thead
                tr
                    th
                        input(type="checkbox" name="checkall")
                    th.stt STT
                    th.thumb Hình ảnh
                    th.title Tiêu đề
                    th.price Giá
                    th.position Vị trí sản phẩm
                    th.status Trạng thái
                    th.actions Hành động
            tbody
                if !products || products.length === 0
                    tr
                        td(colspan='7') Chưa có sản phẩm
                else
                    each product, idx in products
                        tr
                            td
                                input(type="checkbox" name="id" value=product.id)
                            td.stt #{pagination.limitItem*(pagination.currentPage - 1) + (idx + 1)}
                            td
                                img(src=product.thumbnail, alt=product.title, width='100px', height='auto')
                            td #{product.title}
                            td #{product.price}$
                            td 
                                input(
                                    type="number"
                                    value=product.position
                                    style="width: 60px"
                                    min="1"
                                    name="position"
                                )
                            td
                                if product.status === 'active'
                                    a(
                                        href='javascript:;'
                                        data-status=product.status
                                        data-id=product.id
                                        class='badge badge-success'
                                        button-change-status
                                    ) Hoạt động
                                else
                                    a(
                                        href='javascript:;'
                                        data-status=product.status
                                        data-id=product.id
                                        class='badge badge-danger'
                                        button-change-status
                                    ) Dừng hoạt động
                            td
                                a(href=`/admin/products/details/${product._id}`, class='btn btn-secondary btn-sm') Chi tiết
                                a(href=`/admin/products/edit/${product._id}`, class='btn btn-warning btn-sm') Sửa
                                button(href=`/admin/products/delete/${product._id}`, 
                                  class='btn btn-danger btn-sm'
                                  data-id=product.id
                                  button-delete
                                  ) Xóa
                                

    +pagination(pagination)

    form(
        action=""
        method="POST"
        id="form-change-status"
        data-path=`/admin/products/change-status`
    )
    form(
        action=""
        method="POST"
        id="form-delete-item"
        data-path=`/admin/products/delete`
    )

    script(src="/admin/js/product.js")
